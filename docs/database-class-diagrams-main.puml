@startuml Diagrama de Clases - Tabla Principal DynamoDB
' Sistema de Gestión de Espacios - Arquitectura MainDynamoDBTable
' Generado: 2025-12-08
' Nota: Tablas especializadas (Idempotency, Themes, CircuitState, WebSocket) excluidas

!define LAYOUT top to bottom direction

skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam class {
    BackgroundColor<<table>> LightBlue
    BackgroundColor<<lambda>> LightGreen
    BorderColor Black
    ArrowColor Black
}
skinparam packageStyle rectangle
skinparam nodesep 10
skinparam ranksep 20

'==============================================================================
' TABLA PRINCIPAL DYNAMODB (MainDynamoDBTable)
'==============================================================================
class MainDynamoDBTable <<table>> {
    **Primary Key**
    + PK: String (HASH)
    + SK: String (RANGE)
    --
    **GSI1: Global Secondary Index 1**
    + GSI1PK: String (HASH)
    + GSI1SK: String (RANGE)
    --
    **Attributes Comunes**
    + empresa_id: String (Aislamiento de tenant)
    + createdAt: String (ISO)
    + updatedAt: String (ISO)
    + status: String
    --
    **Attributes Específicos de Entidad**
    + email: String (Usuario)
    + nombre: String (Usuario, Espacio, Zona)
    + role: String (Usuario)
    + fecha_inicio: String (Reserva)
    + fecha_fin: String (Reserva)
    + capacidad: Number (Espacio, Zona)
    + ubicacion: String (Espacio, Zona)
    + tipo: String (Espacio, Zona)
    + horario: Object (Espacio, Zona)
    + metadata: Object (generic JSON)
    --
    **Streams**
    + StreamViewType: NEW_AND_OLD_IMAGES
    + PointInTimeRecovery: Enabled
    --
    **Patrones de Acceso (vía PK/SK)**
    1. Usuario: PK=USER#<email> SK=PROFILE
    2. Espacio: PK=EMPRESA#<id> SK=ESPACIO#<id>
    3. Reserva: PK=ESPACIO#<id> SK=RESERVA#<id>
    4. Zona: PK=ESPACIO#<id> SK=ZONA#<id>
    5. Responsable: PK=EMPRESA#<id> SK=RESPONSABLE#<id>
    6. Organization: PK=ORG#<id> SK=CONFIG
    7. Personalization: PK=CLIENT#<id> SK=SETTINGS
    --
    **Patrones de Acceso GSI1**
    1. Consultar todos los espacios por empresa
    2. Consultar todas las reservas por usuario
    3. Consultar todas las zonas por tipo
    4. Consultar organizaciones por status
}

'==============================================================================
' LAMBDAS DE AUTENTICACIÓN
'==============================================================================
package "Autenticación (7 Lambdas)" {
    class "Lambda: register" <<lambda>> {
        **Handler:** auth.register
        **Route:** POST /auth/register
        --
        **Operaciones**
        + Create: USER#<email> / PROFILE
        + Attributes: email, nombre, role, empresa_id
        --
        **Integración Cognito**
        - Crear usuario Cognito
        - Configurar atributos personalizados
        - Confirmar cuenta de usuario
        --
        **Idempotency:** x-idempotency-key
    }

    class "Lambda: login" <<lambda>> {
        **Handler:** auth.login
        **Route:** POST /auth/login
        --
        **Operaciones**
        + Read: USER#<email> / PROFILE
        + Update: timestamp de lastLogin
        --
        **Integración Cognito**
        - Autenticar usuario
        - Devolver tokens JWT
        - Rastrear metadata de login
    }

    class "Lambda: verify" <<lambda>> {
        **Handler:** auth.verify
        **Route:** GET /auth/verify
        --
        **Operaciones**
        + Read: USER#<email> / PROFILE
        + Verificar token JWT
        + Devolver metadata del usuario
    }

    class "Lambda: updateProfile" <<lambda>> {
        **Handler:** auth.updateProfile
        **Route:** PUT /auth/profile
        --
        **Operaciones**
        + Update: USER#<email> / PROFILE
        + Attributes: nombre, metadata
        --
        **Autorización:** JWT requerido
    }

    class "Lambda: requestPasswordReset" <<lambda>> {
        **Handler:** auth.requestPasswordReset
        **Route:** POST /auth/password/reset-request
        --
        **Operaciones**
        + Read: USER#<email> / PROFILE
        + Enviar código de reseteo vía email
        --
        **Integración Cognito**
        - ForgotPassword API
        - Entrega de email SES
    }

    class "Lambda: confirmPasswordReset" <<lambda>> {
        **Handler:** auth.confirmPasswordReset
        **Route:** POST /auth/password/reset-confirm
        --
        **Operaciones**
        + Update: password de USER#<email> / PROFILE
        --
        **Integración Cognito**
        - ConfirmForgotPassword API
        - Validar código de reseteo
    }

    class "Lambda: cognitoPostConfirmation" <<lambda>> {
        **Handler:** cognitoAuth.postConfirmation
        **Trigger:** Cognito Post-Confirmation
        --
        **Operaciones**
        + Create: USER#<email> / PROFILE
        + Attributes del evento Cognito
        --
        **Propósito**
        Sincronizar usuario Cognito a DynamoDB
        después de confirmación exitosa
    }
}

'==============================================================================
' LAMBDAS DE USUARIO
'==============================================================================
package "Usuarios (5 Lambdas)" {
    class "Lambda: createUsuario" <<lambda>> {
        **Handler:** usuarios.createUsuario
        **Route:** POST /usuarios
        --
        **Operaciones**
        + Create: USER#<email> / PROFILE
        + Attributes: nombre, email, role, empresa_id
        --
        **Multi-tenancy:** Aislamiento de empresa_id
        **Autorización:** Rol admin requerido
    }

    class "Lambda: getUsuario" <<lambda>> {
        **Handler:** usuarios.getUsuario
        **Route:** GET /usuarios/{email}
        --
        **Operaciones**
        + Read: USER#<email> / PROFILE
        --
        **Autorización:** JWT requerido
        **Filters:** Coincidencia empresa_id
    }

    class "Lambda: listUsuarios" <<lambda>> {
        **Handler:** usuarios.listUsuarios
        **Route:** GET /usuarios
        --
        **Operaciones**
        + Scan: Filtrar por empresa_id
        + O Query: GSI1PK=EMPRESA#<id> GSI1SK begins_with USER#
        --
        **Pagination:** LastEvaluatedKey
        **Autorización:** Rol admin
    }

    class "Lambda: updateUsuario" <<lambda>> {
        **Handler:** usuarios.updateUsuario
        **Route:** PUT /usuarios/{email}
        --
        **Operaciones**
        + Update: USER#<email> / PROFILE
        + Attributes: nombre, role, metadata
        --
        **Autorización:** Admin o el mismo usuario
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: deleteUsuario" <<lambda>> {
        **Handler:** usuarios.deleteUsuario
        **Route:** DELETE /usuarios/{email}
        --
        **Operaciones**
        + Delete: USER#<email> / PROFILE
        + Cascade: Actualizar reservas relacionadas
        --
        **Autorización:** Rol admin
        **Soft Delete:** status=INACTIVE
    }
}

'==============================================================================
' LAMBDAS DE ESPACIO
'==============================================================================
package "Espacios (6 Lambdas)" {
    class "Lambda: createEspacio" <<lambda>> {
        **Handler:** espacios.createEspacio
        **Route:** POST /espacios
        --
        **Operaciones**
        + Create: EMPRESA#<id> / ESPACIO#<uuid>
        + Attributes: nombre, tipo, capacidad, ubicacion, horario
        --
        **Multi-tenancy:** empresa_id requerido
        **Autorización:** Rol admin
        **UUID Generation:** uuid v4
    }

    class "Lambda: getEspacio" <<lambda>> {
        **Handler:** espacios.getEspacio
        **Route:** GET /espacios/{id}
        --
        **Operaciones**
        + Read: EMPRESA#<empresa_id> / ESPACIO#<id>
        --
        **Autorización:** JWT requerido
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: listEspacios" <<lambda>> {
        **Handler:** espacios.listEspacios
        **Route:** GET /espacios
        --
        **Operaciones**
        + Query: PK=EMPRESA#<id> SK begins_with ESPACIO#
        --
        **Filters:** tipo, capacidad_min, status
        **Autorización:** JWT requerido
    }

    class "Lambda: updateEspacio" <<lambda>> {
        **Handler:** espacios.updateEspacio
        **Route:** PUT /espacios/{id}
        --
        **Operaciones**
        + Update: EMPRESA#<empresa_id> / ESPACIO#<id>
        + Attributes: nombre, capacidad, horario, status
        --
        **Autorización:** Rol admin
        **Validation:** Coincidencia empresa_id
        **DynamoDB Streams:** Dispara notificaciones
    }

    class "Lambda: deleteEspacio" <<lambda>> {
        **Handler:** espacios.deleteEspacio
        **Route:** DELETE /espacios/{id}
        --
        **Operaciones**
        + Delete: EMPRESA#<empresa_id> / ESPACIO#<id>
        + Cascade: Cancelar reservas futuras
        --
        **Autorización:** Rol admin
        **Soft Delete:** status=DELETED
    }

    class "Lambda: getEspacioEstado" <<lambda>> {
        **Handler:** espacios.getEspacioEstado
        **Route:** GET /espacios/{id}/estado
        --
        **Operaciones**
        + Read: EMPRESA#<empresa_id> / ESPACIO#<id>
        + Query: Reservas activas para espacio
        --
        **Returns:** DISPONIBLE | OCUPADO | MANTENIMIENTO
        **Real-time:** Notificación WebSocket
    }
}

'==============================================================================
' LAMBDAS DE RESERVA
'==============================================================================
package "Reservas (7 Lambdas)" {
    class "Lambda: createReserva" <<lambda>> {
        **Handler:** reservas.createReserva
        **Route:** POST /reservas
        --
        **Operaciones**
        + Create: ESPACIO#<id> / RESERVA#<uuid>
        + Attributes: usuario_email, fecha_inicio, fecha_fin, empresa_id
        --
        **Validaciones**
        - Disponibilidad del espacio
        - Conflictos de horario
        - Permisos de usuario
        --
        **Multi-tenancy:** Aislamiento de empresa_id
        **Idempotency:** Requerido
        **DynamoDB Streams:** Dispara notificaciones
    }

    class "Lambda: getReserva" <<lambda>> {
        **Handler:** reservas.getReserva
        **Route:** GET /reservas/{id}
        --
        **Operaciones**
        + Read: ESPACIO#<espacio_id> / RESERVA#<id>
        --
        **Autorización:** Dueño usuario o admin
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: listReservas" <<lambda>> {
        **Handler:** reservas.listReservas
        **Route:** GET /reservas
        --
        **Operaciones**
        + Query: PK=ESPACIO#<id> SK begins_with RESERVA#
        + O Query: GSI1PK=USER#<email> GSI1SK begins_with RESERVA#
        --
        **Filters:** fecha_inicio, fecha_fin, status
        **Autorización:** JWT requerido
    }

    class "Lambda: updateReserva" <<lambda>> {
        **Handler:** reservas.updateReserva
        **Route:** PUT /reservas/{id}
        --
        **Operaciones**
        + Update: ESPACIO#<espacio_id> / RESERVA#<id>
        + Attributes: fecha_inicio, fecha_fin, status
        --
        **Validaciones**
        - Disponibilidad de nuevo horario
        - Permisos de usuario
        --
        **Autorización:** Dueño usuario o admin
        **DynamoDB Streams:** Dispara notificaciones
    }

    class "Lambda: deleteReserva" <<lambda>> {
        **Handler:** reservas.deleteReserva
        **Route:** DELETE /reservas/{id}
        --
        **Operaciones**
        + Update: ESPACIO#<espacio_id> / RESERVA#<id> status=CANCELLED
        --
        **Autorización:** Dueño usuario o admin
        **Soft Delete:** status=CANCELLED
        **Notifications:** Email + WebSocket
    }

    class "Lambda: listReservasByUsuario" <<lambda>> {
        **Handler:** reservas.listReservasByUsuario
        **Route:** GET /usuarios/{email}/reservas
        --
        **Operaciones**
        + Query: GSI1PK=USER#<email> GSI1SK begins_with RESERVA#
        --
        **Filters:** fecha, status, empresa_id
        **Autorización:** El mismo usuario o admin
    }

    class "Lambda: listReservasByEspacio" <<lambda>> {
        **Handler:** reservas.listReservasByEspacio
        **Route:** GET /espacios/{id}/reservas
        --
        **Operaciones**
        + Query: PK=ESPACIO#<id> SK begins_with RESERVA#
        --
        **Filters:** fecha_range, status
        **Autorización:** JWT requerido
    }
}

'==============================================================================
' LAMBDAS DE ZONA
'==============================================================================
package "Zonas (5 Lambdas)" {
    class "Lambda: createZona" <<lambda>> {
        **Handler:** zonas.createZona
        **Route:** POST /zonas
        --
        **Operaciones**
        + Create: ESPACIO#<id> / ZONA#<uuid>
        + Attributes: nombre, tipo, capacidad, ubicacion
        --
        **Parent:** ESPACIO#<id>
        **Multi-tenancy:** empresa_id del padre
        **Autorización:** Rol admin
    }

    class "Lambda: getZona" <<lambda>> {
        **Handler:** zonas.getZona
        **Route:** GET /zonas/{id}
        --
        **Operaciones**
        + Read: ESPACIO#<espacio_id> / ZONA#<id>
        --
        **Autorización:** JWT requerido
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: listZonas" <<lambda>> {
        **Handler:** zonas.listZonas
        **Route:** GET /zonas
        --
        **Operaciones**
        + Query: PK=ESPACIO#<id> SK begins_with ZONA#
        --
        **Filters:** tipo, capacidad_min, status
        **Autorización:** JWT requerido
    }

    class "Lambda: updateZona" <<lambda>> {
        **Handler:** zonas.updateZona
        **Route:** PUT /zonas/{id}
        --
        **Operaciones**
        + Update: ESPACIO#<espacio_id> / ZONA#<id>
        + Attributes: nombre, capacidad, tipo, status
        --
        **Autorización:** Rol admin
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: deleteZona" <<lambda>> {
        **Handler:** zonas.deleteZona
        **Route:** DELETE /zonas/{id}
        --
        **Operaciones**
        + Delete: ESPACIO#<espacio_id> / ZONA#<id>
        --
        **Autorización:** Rol admin
        **Soft Delete:** status=INACTIVE
    }
}

'==============================================================================
' LAMBDAS DE RESPONSABLE
'==============================================================================
package "Responsables (5 Lambdas)" {
    class "Lambda: createResponsable" <<lambda>> {
        **Handler:** responsables.createResponsable
        **Route:** POST /responsables
        --
        **Operaciones**
        + Create: EMPRESA#<id> / RESPONSABLE#<uuid>
        + Attributes: nombre, email, telefono, cargo
        --
        **Multi-tenancy:** empresa_id requerido
        **Autorización:** Rol admin
    }

    class "Lambda: getResponsable" <<lambda>> {
        **Handler:** responsables.getResponsable
        **Route:** GET /responsables/{id}
        --
        **Operaciones**
        + Read: EMPRESA#<empresa_id> / RESPONSABLE#<id>
        --
        **Autorización:** JWT requerido
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: listResponsables" <<lambda>> {
        **Handler:** responsables.listResponsables
        **Route:** GET /responsables
        --
        **Operaciones**
        + Query: PK=EMPRESA#<id> SK begins_with RESPONSABLE#
        --
        **Filters:** cargo, status
        **Autorización:** JWT requerido
    }

    class "Lambda: updateResponsable" <<lambda>> {
        **Handler:** responsables.updateResponsable
        **Route:** PUT /responsables/{id}
        --
        **Operaciones**
        + Update: EMPRESA#<empresa_id> / RESPONSABLE#<id>
        + Attributes: nombre, email, telefono, cargo
        --
        **Autorización:** Rol admin
        **Validation:** Coincidencia empresa_id
    }

    class "Lambda: deleteResponsable" <<lambda>> {
        **Handler:** responsables.deleteResponsable
        **Route:** DELETE /responsables/{id}
        --
        **Operaciones**
        + Delete: EMPRESA#<empresa_id> / RESPONSABLE#<id>
        --
        **Autorización:** Rol admin
        **Soft Delete:** status=INACTIVE
    }
}

'==============================================================================
' LAMBDAS DE ORGANIZACIÓN
'==============================================================================
package "Organizaciones (4 Lambdas)" {
    class "Lambda: createOrganization" <<lambda>> {
        **Handler:** organizations.createOrganization
        **Route:** POST /organizations
        --
        **Operaciones**
        + Create: ORG#<uuid> / CONFIG
        + Attributes: name, settings, features
        --
        **Autorización:** Super admin
        **UUID Generation:** uuid v4
    }

    class "Lambda: getOrganization" <<lambda>> {
        **Handler:** organizations.getOrganization
        **Route:** GET /organizations/{id}
        --
        **Operaciones**
        + Read: ORG#<id> / CONFIG
        --
        **Autorización:** Miembro de org
    }

    class "Lambda: updateOrganization" <<lambda>> {
        **Handler:** organizations.updateOrganization
        **Route:** PUT /organizations/{id}
        --
        **Operaciones**
        + Update: ORG#<id> / CONFIG
        + Attributes: settings, features, status
        --
        **Autorización:** Admin de org
    }

    class "Lambda: listOrganizations" <<lambda>> {
        **Handler:** organizations.listOrganizations
        **Route:** GET /organizations
        --
        **Operaciones**
        + Query: GSI1PK=ORG_LIST GSI1SK begins_with ORG#
        + O Scan: Filtrar por status
        --
        **Autorización:** Super admin
    }
}

'==============================================================================
' LAMBDAS DE PERSONALIZACIÓN Y DASHBOARD
'==============================================================================
package "Personalización y Métricas (4 Lambdas)" {
    class "Lambda: getPersonalization" <<lambda>> {
        **Handler:** personalization.getPersonalization
        **Route:** GET /personalization/{clientId}
        --
        **Operaciones**
        + Read: CLIENT#<id> / SETTINGS
        --
        **Returns:** Preferencias UI, tema, idioma
        **Autorización:** Dueño del cliente
    }

    class "Lambda: updatePersonalization" <<lambda>> {
        **Handler:** personalization.updatePersonalization
        **Route:** PUT /personalization/{clientId}
        --
        **Operaciones**
        + Update: CLIENT#<id> / SETTINGS
        + Attributes: theme, locale, preferences
        --
        **Autorización:** Dueño del cliente
        **SNS Notification:** Dispara push WebSocket
    }

    '==========================================================================
    ' LAMBDAS DE DASHBOARD Y MÉTRICAS
    '==========================================================================
    class "Lambda: getDashboard" <<lambda>> {
        **Handler:** dashboard.getDashboard
        **Route:** GET /dashboard
        --
        **Operaciones**
        + Consultas agregadas entre entidades
        + Contar espacios, reservas, usuarios
        + Calcular métricas de utilización
        --
        **Multi-tenancy:** Filtro de empresa_id
        **Autorización:** Rol admin
        **Caching:** ElastiCache (opcional)
    }

    class "Lambda: getMetrics" <<lambda>> {
        **Handler:** dashboard.getMetrics
        **Route:** GET /dashboard/metrics
        --
        **Operaciones**
        + Consultas de series temporales
        + Tendencias de reservas
        + Utilización de espacios
        --
        **Autorización:** Rol admin
        **CloudWatch Integration:** Métricas personalizadas
    }
}

'==============================================================================
' RELACIONES DE TABLA
'==============================================================================
    MainDynamoDBTable <-- "Lambda: register" : Crear USER
    MainDynamoDBTable <-- "Lambda: login" : Leer/Actualizar USER
    MainDynamoDBTable <-- "Lambda: verify" : Leer USER
    MainDynamoDBTable <-- "Lambda: updateProfile" : Actualizar USER
    MainDynamoDBTable <-- "Lambda: requestPasswordReset" : Leer USER
    MainDynamoDBTable <-- "Lambda: confirmPasswordReset" : Actualizar USER
    MainDynamoDBTable <-- "Lambda: cognitoPostConfirmation" : Crear USER

    MainDynamoDBTable <-- "Lambda: createUsuario" : Crear USER
    MainDynamoDBTable <-- "Lambda: getUsuario" : Leer USER
    MainDynamoDBTable <-- "Lambda: listUsuarios" : Scan/Query USER
    MainDynamoDBTable <-- "Lambda: updateUsuario" : Actualizar USER
    MainDynamoDBTable <-- "Lambda: deleteUsuario" : Eliminar USER

    MainDynamoDBTable <-- "Lambda: createEspacio" : Crear ESPACIO
    MainDynamoDBTable <-- "Lambda: getEspacio" : Leer ESPACIO
    MainDynamoDBTable <-- "Lambda: listEspacios" : Query ESPACIO
    MainDynamoDBTable <-- "Lambda: updateEspacio" : Actualizar ESPACIO
    MainDynamoDBTable <-- "Lambda: deleteEspacio" : Eliminar ESPACIO
    MainDynamoDBTable <-- "Lambda: getEspacioEstado" : Leer ESPACIO + RESERVAS

    MainDynamoDBTable <-- "Lambda: createReserva" : Crear RESERVA
    MainDynamoDBTable <-- "Lambda: getReserva" : Leer RESERVA
    MainDynamoDBTable <-- "Lambda: listReservas" : Query RESERVA
    MainDynamoDBTable <-- "Lambda: updateReserva" : Actualizar RESERVA
    MainDynamoDBTable <-- "Lambda: deleteReserva" : Actualizar RESERVA
    MainDynamoDBTable <-- "Lambda: listReservasByUsuario" : Query RESERVA (GSI1)
    MainDynamoDBTable <-- "Lambda: listReservasByEspacio" : Query RESERVA

    MainDynamoDBTable <-- "Lambda: createZona" : Crear ZONA
    MainDynamoDBTable <-- "Lambda: getZona" : Leer ZONA
    MainDynamoDBTable <-- "Lambda: listZonas" : Query ZONA
    MainDynamoDBTable <-- "Lambda: updateZona" : Actualizar ZONA
    MainDynamoDBTable <-- "Lambda: deleteZona" : Eliminar ZONA

    MainDynamoDBTable <-- "Lambda: createResponsable" : Crear RESPONSABLE
    MainDynamoDBTable <-- "Lambda: getResponsable" : Leer RESPONSABLE
    MainDynamoDBTable <-- "Lambda: listResponsables" : Query RESPONSABLE
    MainDynamoDBTable <-- "Lambda: updateResponsable" : Actualizar RESPONSABLE
    MainDynamoDBTable <-- "Lambda: deleteResponsable" : Eliminar RESPONSABLE

    MainDynamoDBTable <-- "Lambda: createOrganization" : Crear ORG
    MainDynamoDBTable <-- "Lambda: getOrganization" : Leer ORG
    MainDynamoDBTable <-- "Lambda: updateOrganization" : Actualizar ORG
    MainDynamoDBTable <-- "Lambda: listOrganizations" : Query/Scan ORG

    MainDynamoDBTable <-- "Lambda: getPersonalization" : Leer CLIENT
    MainDynamoDBTable <-- "Lambda: updatePersonalization" : Actualizar CLIENT

    MainDynamoDBTable <-- "Lambda: getDashboard" : Consultas Agregadas
    MainDynamoDBTable <-- "Lambda: getMetrics" : Consultas de Series Temporales

'==============================================================================
' NOTAS DE ARQUITECTURA
'==============================================================================
note top of MainDynamoDBTable
    **Patrón de Diseño de Tabla Única**
    Todas las entidades almacenadas en una tabla usando patrones PK/SK
    
    **Estrategia Multi-tenancy**
    Cada registro incluye empresa_id para aislamiento de tenant
    Seguridad a nivel de fila vía IAM y filtros de aplicación
    
    **Patrones de Diseño de Claves**
    - PK: Identificador de entidad o entidad padre
    - SK: Tipo de entidad + ID específico
    - GSI1: Índice invertido para consultas alternativas
    - empresa_id: Obligatorio para todos los datos de tenant
    
    **Soft Deletes**
    Registros marcados como INACTIVE/DELETED en vez de eliminación
    Preserva pista de auditoría e integridad referencial
    
    **DynamoDB Streams**
    Dispara notificaciones WebSocket para actualizaciones en tiempo real
    Procesamiento de eventos de stream para logs de auditoría
end note

note bottom of MainDynamoDBTable
    **Ejemplos de Patrones de Acceso**
    
    1. Obtener Perfil de Usuario:
       PK=USER#user@example.com SK=PROFILE
    
    2. Listar Espacios para Empresa:
       PK=EMPRESA#abc-123 SK begins_with ESPACIO#
    
    3. Listar Reservas para Espacio:
       PK=ESPACIO#xyz-789 SK begins_with RESERVA#
    
    4. Listar Reservas del Usuario (vía GSI1):
       GSI1PK=USER#user@example.com GSI1SK begins_with RESERVA#
    
    5. Listar Zonas en Espacio:
       PK=ESPACIO#xyz-789 SK begins_with ZONA#
    
    6. Obtener Configuración de Organización:
       PK=ORG#org-456 SK=CONFIG
    
    **Optimizaciones de Rendimiento**
    - Claves compuestas evitan particiones calientes
    - GSI1 habilita búsquedas inversas eficientes
    - Operaciones batch para entidades relacionadas
    - Escrituras condicionales previenen condiciones de carrera
end note

'==============================================================================
' LEYENDA
'==============================================================================
legend right
    **Categorías de Lambda:**
    - Auth (7): Autenticación de usuario y perfil
    - Usuarios (5): CRUD de gestión de usuarios
    - Espacios (6): Gestión de espacios + estado
    - Reservas (7): Ciclo de vida de reservas
    - Zonas (5): Gestión de zonas dentro de espacios
    - Responsables (5): Gestión de personas de contacto
    - Organizations (4): Gestión de configuración de org
    - Personalization (2): Preferencias de usuario
    - Dashboard (2): Métricas y analítica
    
    **Total Lambdas:** 43 funciones
    
    **Patrones Comunes:**
    - Autorización JWT en todos los endpoints
    - Multi-tenancy vía empresa_id
    - Idempotencia para operaciones críticas
    - Soft deletes para pista de auditoría
    - DynamoDB Streams para notificaciones
endlegend

@enduml
